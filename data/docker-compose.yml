version: "3.1"

services:
  virtual-traffic-count:
    image: anywaysopen/traffic-count-api:prod
    volumes:
      - /var/services/shared/virtual-traffic/:/var/app/data/
      - /var/services/logs/virtual-traffic-counts/:/var/app/logs/
      - /var/services/deployment/data/config/virtual-traffic-count:/var/app/config
    ports:
      - 5006:5000
  virtual-traffic-mapmatching:
    image: anywaysopen/traffic-count-mapmatching:prod
    volumes:
      - /var/services/virtual-traffic-mapmatching/data/:/var/app/data/
      - /var/services/logs/virtual-traffic-mapmatching/:/var/app/logs/
      - /var/services/shared/virtual-traffic/:/var/app/output/
      - /var/services/deployment/data/config/virtual-traffic-mapmatching:/var/app/config
    environment:
      BIKEDATA_DB: /run/secrets/db_connection_string
    secrets:
      - db_connection_string
  virtual-traffic-dump:
    image: anywaysopen/traffic-count-dump:prod
    volumes:
      - /var/services/shared/virtual-traffic/:/var/app/input/
      - /var/services/files/counts/:/var/app/output/
      - /var/services/logs/virtual-traffic-dump/:/var/app/logs/
      - /var/services/deployment/data/config/virtual-traffic-dump:/var/app/config

secrets:
  db_connection_string:
    external: true

