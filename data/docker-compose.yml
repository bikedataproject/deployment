version: "3.1"

services:
  heatmap-tiles-service:
    image: bikedataproject/heatmap-tiles-service:staging
    volumes:
      - /var/services/heatmap/db:/var/app/data
      - /var/services/heatmap/tiles:/var/app/tiles
      - /var/services/heatmap/logs:/var/app/logs
    environment:
      BIKEDATA_DB: /run/secrets/db_connection_string
    secrets:
      - db_connection_string
  virtual-traffic-count:
    image: anywaysopen/traffic-count-api:prod
    volumes:
      - /var/services/virtual-traffic-counters/data/:/var/app/data/
      - /var/services/logs/virtual-traffic-counts/:/var/app/logs/
      - /var/services/deployment/data/config/virtual-traffic-count:/var/app/config
    ports:
      - 5006:5000
  virtual-traffic-mapmatching:
    image: anywaysopen/traffic-count-mapmatching:prod
    volumes:
      - /var/services/virtual-traffic-mapmatching/data/:/var/app/data/
      - /var/services/logs/virtual-traffic-mapmatching/:/var/app/logs/
      - /var/services/shared/virtual-traffic/:/var/app/output/
      - /var/services/deployment/data/config/virtual-traffic-mapmatching:/var/app/config
    environment:
      BIKEDATA_DB: /run/secrets/db_connection_string
    secrets:
      - db_connection_string
    ports:
      - 5006:5000

secrets:
  db_connection_string:
    external: true

